# PR Reviewer Assignment Service

Сервис для автоматического назначения ревьюверов на Pull Request'ы, управления командами и пользователями, переназначения ревьюверов и массовой деактивации.

Тестовое задание Backend Trainee (Fall 2025).

---

## Запуск через Docker

```
docker-compose up --build
```

Сервис будет доступен на:

```
http://localhost:8080
```

PostgreSQL поднимается автоматически, миграции Flyway применяются при старте.

## Эндпоинты

Основные:

- `POST /team/add`
- `GET /team/get`
- `POST /users/setIsActive`
- `GET /users/getReview`
- `POST /pullRequest/create`
- `POST /pullRequest/merge`
- `POST /pullRequest/reassign`

Дополнительные:

- `GET /stats/assignments/byUser`
- `POST /users/bulkDeactivate`

## Дополнительный функционал
### Статистика
Эндпоинт `/stats/assignments/byUser` возвращает количество назначений ревьюверов для каждого пользователя.

### Массовая деактивация
`POST /users/bulkDeactivate` деактивирует всех пользователей команды и безопасно переназначает открытые PR.

## Нагрузочное тестирование `/users/bulkDeactivate`

**Профиль нагрузки:** до 10 VU, ~40 секунд  
**Ошибок:** 0%

**Время ответа (`http_req_duration`)**
- Среднее: **≈ 77 ms**
- p90: **≈ 126 ms**
- p95: **≈ 145 ms**

**Вывод:**
Эндпоинт стабильно выдерживает нагрузку.  
Укладывается в требуемый **SLI = 300 ms**.  
Экспериментальная цель **p95 < 100 ms** на данной нагрузке **немного не достигнута**, но общая производительность остаётся в норме для заданных условий тестового задания.

## Вопросы и проблемы, с которыми я столкнулся, и принятые решения

### 1. Разночтения в назначении ревьюверов
В спецификации указано, что допускается 0-2 ревьюверов.  
При тестировании возникали ситуации, когда автор - единственный активный участник команды.  
Было принято решение: если подходящих кандидатов нет, PR создаётся с пустым списком ревьюверов. 

### 2. Переназначение могло выбирать самого автора как ревьюера
На ранней стадии реализации reassign автор PR мог попасть в список кандидатов.  
Добавлена фильтрация: автор исключается из списка возможных новых ревьюверов.

### 3. Массовая деактивация и открытые PR
При массовой деактивации не всегда существовали доступные активные кандидаты в команде.  
Решение: PR остаётся без ревьювера, если никого назначить невозможно.

